# 实现计划

- [x] 1. 创建核心配置和类型定义
  - 创建sitemap配置接口和默认配置文件
  - 定义所有必要的TypeScript类型和接口
  - 建立项目的基础结构和常量定义
  - _需求: 1.1, 5.1, 5.3_

- [x] 2. 实现路由扫描功能
  - [x] 2.1 创建静态路由扫描器
    - 编写函数扫描app目录下的所有page.tsx文件
    - 实现路径到URL的转换逻辑
    - 添加文件修改时间获取功能
    - _需求: 1.1, 1.2_

  - [x] 2.2 实现动态路由处理
    - 识别和处理[slug]等动态路由模式
    - 为博客动态路由生成具体URL列表
    - 实现动态路由的元数据提取
    - _需求: 4.1, 4.2, 4.3_

- [x] 3. 集成博客内容扫描
  - [x] 3.1 复用现有博客系统
    - 利用src/lib/blog.ts中的getAllBlogPosts函数
    - 提取博客文章的slug和元数据信息
    - 实现博客文章URL生成逻辑
    - _需求: 3.1, 3.2, 3.3_

  - [x] 3.2 处理博客文章元数据
    - 从markdown文件frontmatter提取发布日期
    - 获取文件的最后修改时间
    - 为博客文章设置适当的优先级和更新频率
    - _需求: 2.1, 2.2, 2.3, 3.4_

- [x] 4. 实现XML生成器
  - [x] 4.1 创建sitemap条目生成器
    - 实现SitemapEntry对象的创建逻辑
    - 添加URL验证和清理功能
    - 实现优先级和更新频率的自动分配
    - _需求: 1.3, 2.2, 2.3, 2.4_

  - [x] 4.2 构建XML输出功能
    - 实现符合sitemap.xml标准的XML生成
    - 添加适当的XML头部和命名空间声明
    - 确保所有特殊字符的正确转义
    - _需求: 1.3, 1.4_

- [x] 5. 实现配置管理系统
  - 创建sitemap.config.js配置文件支持
  - 实现配置的加载和验证逻辑
  - 添加默认配置和配置合并功能
  - _需求: 5.1, 5.2, 5.4_

- [x] 6. 创建主要的sitemap生成器类
  - [x] 6.1 实现SitemapGenerator核心类
    - 整合所有扫描器和生成器组件
    - 实现主要的generate()方法
    - 添加错误处理和日志记录
    - _需求: 1.1, 1.2, 1.3, 1.4_

  - [x] 6.2 添加文件写入功能
    - 实现sitemap.xml文件的写入逻辑
    - 确保文件写入到正确的public目录
    - 添加写入错误的处理机制
    - _需求: 1.4_

- [x] 7. 集成到构建流程
  - [x] 7.1 创建构建脚本
    - 编写独立的sitemap生成脚本
    - 添加命令行参数支持
    - 实现构建时的自动执行逻辑
    - _需求: 1.1_

  - [x] 7.2 更新package.json脚本
    - 修改build脚本以包含sitemap生成
    - 添加独立的sitemap生成命令
    - 确保与现有构建流程的兼容性
    - _需求: 1.1_

- [x] 8. 实现错误处理和验证
  - 添加全面的错误捕获和处理
  - 实现URL有效性验证
  - 创建优雅降级机制处理单个文件错误
  - _需求: 4.4_

- [x] 9. 编写单元测试
  - [x] 9.1 测试路由扫描功能
    - 为静态路由扫描器编写测试
    - 测试动态路由处理逻辑
    - 验证路径到URL转换的正确性
    - _需求: 1.1, 1.2, 4.1, 4.2_

  - [x] 9.2 测试博客集成功能
    - 测试博客文章扫描和URL生成
    - 验证元数据提取的准确性
    - 测试博客相关的优先级设置
    - _需求: 3.1, 3.2, 3.3, 3.4_

  - [x] 9.3 测试XML生成和配置
    - 验证生成的XML格式符合标准
    - 测试配置加载和应用逻辑
    - 测试错误处理和边界情况
    - _需求: 1.3, 2.1, 2.2, 2.3, 5.1, 5.2, 5.3, 5.4_

- [x] 10. 创建使用文档和示例
  - 编写README说明如何使用sitemap生成器
  - 创建配置选项的详细文档
  - 提供常见用例的示例配置
  - _需求: 5.1, 5.2, 5.3, 5.4_